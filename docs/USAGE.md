# Jellyfin 标签筛选器 (AND 逻辑)

> 一个支持 AND 逻辑的 Jellyfin 标签筛选工具，完美支持手机端访问

## 📖 功能特点

- ✅ **AND 逻辑筛选**：同时选择多个标签，只显示包含所有选中标签的媒体
- ✅ **响应式设计**：自动适配手机、平板、电脑屏幕
- ✅ **双视图模式**：网格视图和列表视图随意切换
- ✅ **标签搜索**：快速查找需要的标签
- ✅ **实时筛选**：选择标签后立即显示结果
- ✅ **点击跳转**：点击媒体项直接在 Jellyfin 中打开播放
- ✅ **配置保存**：自动记住服务器配置，无需重复输入

## 🚀 快速开始

### 方案 A：通过浏览器直接访问（推荐）

1. **打开 HTML 文件**
   - 方式 1：双击 `jellyfin_tag_filter.html` 文件
   - 方式 2：在浏览器中打开文件路径

2. **填写配置信息**
   - Jellyfin 服务器地址：`http://你的服务器IP:8096`（如果是本机就是 `http://localhost:8096`）
   - API 密钥：从 Jellyfin 管理后台获取
   - 媒体库 ID：从 Jellyfin 媒体库 URL 中获取

3. **点击"加载媒体库"按钮**

4. **开始筛选**
   - 点击标签进行选择（可多选）
   - 结果会自动更新，只显示包含所有选中标签的媒体

### 方案 B：部署到 Jellyfin 服务器（更便捷）

将文件部署到 Jellyfin 服务器，这样可以通过服务器 URL 访问，手机端更方便。

1. **复制文件到 Jellyfin wwwroot 目录**
   ```powershell
   # 复制 HTML 文件到 Jellyfin 服务器目录
   Copy-Item "jellyfin_tag_filter.html" "D:\JellyfinServer\wwwroot\tag_filter.html"
   ```

2. **通过浏览器访问**
   - 电脑：`http://localhost:8096/tag_filter.html`
   - 手机：`http://你的服务器IP:8096/tag_filter.html`

3. **首次使用配置**
   - 填写配置信息（只需配置一次，会自动保存）
   - 加载媒体库

## 📱 手机端使用

### 方式 1：浏览器访问

1. 打开手机浏览器（Safari、Chrome、Edge 等）
2. 输入地址：`http://你的服务器IP:8096/tag_filter.html`
   - 如果已部署到服务器
   - 或者通过其他方式访问 HTML 文件
3. 正常使用，界面会自动适配手机屏幕

### 方式 2：添加到主屏幕（PWA 体验）

**iOS (Safari):**
1. 在 Safari 中打开筛选器页面
2. 点击底部"分享"按钮
3. 选择"添加到主屏幕"
4. 像 APP 一样启动

**Android (Chrome):**
1. 在 Chrome 中打开筛选器页面
2. 点击右上角菜单
3. 选择"添加到主屏幕"
4. 像 APP 一样启动

## 🔑 如何获取配置信息

### 1. 获取 API 密钥

1. 登录 Jellyfin Web 管理后台
2. 进入 **设置 (Dashboard)** → **高级 (Advanced)** → **API 密钥 (API Keys)**
3. 点击 **添加 API 密钥**
4. 输入名称（如 "标签筛选器"），点击确定
5. 复制生成的 API 密钥

### 2. 获取媒体库 ID

**方法 1：通过 URL 获取**
1. 在 Jellyfin Web 中打开你的媒体库（如"电影"）
2. 查看浏览器地址栏，URL 类似：
   ```
   http://localhost:8096/web/index.html#!/movies.html?topParentId=abc123def456
   ```
3. `abc123def456` 就是媒体库 ID

**方法 2：通过 API 查询**
1. 在浏览器中访问（替换你的 API 密钥）：
   ```
   http://localhost:8096/Library/VirtualFolders?api_key=你的API密钥
   ```
2. 在返回的 JSON 中找到对应媒体库的 `ItemId` 字段

### 3. 服务器地址

- 本机访问：`http://localhost:8096`
- 局域网访问：`http://192.168.x.x:8096`（替换为服务器实际 IP）
- 公网访问：`http://你的域名或公网IP:端口`

## 💡 使用技巧

### AND 逻辑说明

**传统 OR 逻辑（Jellyfin 原生）:**
- 选择标签 A 和 B
- 显示：包含 A **或** B 的所有媒体

**AND 逻辑（本工具）:**
- 选择标签 A 和 B
- 显示：**同时**包含 A **和** B 的媒体

### 筛选示例

假设你有以下媒体：
- 电影 1：标签 [动作, 科幻]
- 电影 2：标签 [动作, 喜剧]
- 电影 3：标签 [科幻, 惊悚]

**选择标签：动作 + 科幻**
- 本工具（AND）：只显示电影 1
- Jellyfin 原生（OR）：显示电影 1、2、3

### 快速筛选技巧

1. **标签搜索框**：有很多标签时，用搜索框快速定位
2. **标签计数**：每个标签旁边的数字显示有多少个媒体包含该标签
3. **排序规则**：标签按出现次数从多到少排序
4. **视图切换**：网格视图看海报，列表视图看详情

## 🎨 界面说明

### 配置区域
- 填写 Jellyfin 服务器信息
- 配置会自动保存到浏览器

### 标签选择区域
- 显示所有可用标签
- 点击标签选择/取消（蓝色 = 已选）
- 搜索框可以快速查找标签

### 结果展示区域
- 网格视图：展示海报图
- 列表视图：展示详细信息
- 点击任意媒体项可在 Jellyfin 中打开

## 🔧 故障排除

### 问题 1：无法加载媒体库

**可能原因：**
- Jellyfin 服务器未运行
- API 密钥或媒体库 ID 错误
- 网络连接问题

**解决方法：**
1. 确认 Jellyfin 服务器正在运行
2. 检查 API 密钥是否正确（重新生成一个试试）
3. 检查媒体库 ID 是否正确
4. 打开浏览器控制台（F12）查看错误信息

### 问题 2：手机端无法访问

**可能原因：**
- 手机和服务器不在同一网络
- 防火墙阻止

**解决方法：**
1. 确保手机和服务器在同一局域网
2. 在服务器防火墙中开放 8096 端口
3. 使用服务器的局域网 IP 地址而非 localhost

### 问题 3：点击媒体无法跳转

**可能原因：**
- 浏览器阻止弹出窗口

**解决方法：**
1. 允许浏览器弹出窗口
2. 或者按住 Ctrl (Windows) / Cmd (Mac) 点击，在新标签页打开

### 问题 4：标签未显示或不完整

**可能原因：**
- 媒体文件的 NFO 中未包含标签
- 需要重新同步标签

**解决方法：**
1. 运行 Eagle 到 Jellyfin 标签同步工具（如果你使用了该工具）：
   ```powershell
   cd ..\EagleTagToJellyfin\v2
   python sync_v2_simple.py
   ```
2. 等待同步完成后，重新加载本筛选器

## 🆚 与 Jellyfin 原生筛选对比

| 功能 | Jellyfin 原生 | 本工具 |
|------|--------------|--------|
| 标签筛选逻辑 | OR（任一匹配） | AND（全部匹配） |
| 手机端适配 | ✅ | ✅ |
| 标签搜索 | ❌ | ✅ |
| 标签计数显示 | ❌ | ✅ |
| 视图切换 | ✅ | ✅ |
| 实时筛选 | ✅ | ✅ |

## 🔒 安全说明

- API 密钥会保存在浏览器本地存储（localStorage）
- 不会发送到任何第三方服务器
- 仅在本地浏览器和你的 Jellyfin 服务器之间通信
- 建议不要在公共设备上保存 API 密钥

## 📝 更新日志

### v1.0 (2025-10-25)
- ✨ 首次发布
- ✅ 支持 AND 逻辑标签筛选
- ✅ 响应式设计，完美适配手机端
- ✅ 网格/列表双视图
- ✅ 标签搜索功能
- ✅ 配置自动保存

## 📄 许可证

仅供个人使用

## 🤝 配合使用

本工具与 **Eagle 到 Jellyfin 标签同步工具** 配合使用效果最佳：
1. 使用同步工具将 Eagle 标签同步到 Jellyfin
2. 使用本筛选器进行精确的 AND 逻辑筛选

## 💬 反馈

如有问题或建议，请记录在项目文档中。

