# Jellyfin Tag Filter - 持久化使用指南

## 🎯 问题：为什么每次都要重新配置？

**原因分析:**
- ✅ HTML 文件已部署到 Jellyfin 服务器 (只需部署一次)
- ❌ 配置信息存储在浏览器 localStorage (更换浏览器/设备会丢失)
- ❌ 没有保存访问链接 (每次手动输入 URL 很麻烦)

**解决方案:**
我们提供了 **3 种持久化方案**，选择任意一种即可实现"一次配置，永久使用"！

---

## 💡 方案一：快捷链接 (推荐)

### 特点
- ⭐ 最简单、最快速
- 📋 一键生成、一键访问
- 🔗 可跨设备、跨浏览器使用
- 💾 保存到书签或备忘录

### 使用步骤

#### 方法 1: 通过网页生成

1. **首次配置**
   - 访问 `http://YOUR_IP:8096/web/tag_filter_pwa.html`
   - 点击 ⚙️ 设置
   - 输入服务器地址、API Key、媒体库 ID
   - 点击 "加载媒体库"

2. **生成快捷链接**
   - 配置成功后，点击 `📋 分享链接`
   - 链接自动复制到剪贴板
   - 示例: `http://192.168.1.100:8096/web/tag_filter_pwa.html?server=...&key=...&library=...`

3. **保存链接**
   - **电脑端**: 保存为浏览器书签
   - **手机端**: 保存到备忘录/笔记/浏览器书签
   - **跨设备**: 通过微信/邮件发送给自己

4. **以后使用**
   - 直接打开保存的链接
   - 自动完成配置，立即可用！

#### 方法 2: 通过脚本生成

```powershell
cd "C:\Users\Administrator\Documents\Personal_Materials\Scripts\JellyfinTagFilter"
.\create_shortcut.ps1
```

按提示输入配置，自动生成链接并复制到剪贴板。

### 优势
- ✅ 无需记住服务器地址
- ✅ 无需重复输入配置
- ✅ 可在任何设备使用
- ✅ 更换浏览器也能用

---

## 📱 方案二：PWA 安装 (最佳体验)

### 特点
- 🎯 **最佳选择** - 像原生应用一样
- 📱 添加到主屏幕，一键启动
- 💾 配置永久保存在应用中
- 🚀 离线也能浏览 (数据已缓存时)

### 使用步骤

#### iOS (Safari)

1. 用 Safari 打开网页
2. 底部点击 **分享** 按钮 (方框+箭头)
3. 滑动找到 **添加到主屏幕**
4. 点击 **添加**
5. 主屏幕出现应用图标

#### Android (Chrome)

1. 用 Chrome 打开网页
2. 右上角点击 **⋮** 菜单
3. 选择 **添加到主屏幕**
4. 点击 **添加**
5. 主屏幕出现应用图标

#### 桌面浏览器 (Chrome/Edge)

1. 打开网页
2. 地址栏右侧出现 **安装** 图标 (➕)
3. 点击安装
4. 从桌面启动应用

### 优势
- ✅ 独立应用窗口
- ✅ 全屏体验
- ✅ 配置不会丢失
- ✅ 启动速度快

---

## 💾 方案三：配置文件导入导出

### 特点
- 📂 本地文件保存配置
- 🔄 方便备份和迁移
- 🔐 离线保存，更安全

### 使用步骤

#### 导出配置

1. 完成配置后，点击 ⚙️ 设置
2. 点击 `💾 导出` 按钮
3. 保存 `jellyfin_tag_filter_config.json` 文件

#### 导入配置

1. 在新设备/浏览器上打开页面
2. 点击 ⚙️ 设置
3. 点击 `📂 导入` 按钮
4. 选择之前保存的配置文件
5. 自动完成配置

### 优势
- ✅ 配置文件可加密保存
- ✅ 方便批量配置多个设备
- ✅ 可版本控制

---

## 🔄 智能部署 - 避免重复部署

### 新版本改进

以前每次运行 `deploy.ps1` 都会复制文件，即使文件没有变化。

**现在:**
```powershell
.\deploy.ps1
```

- ✅ 自动检测文件是否有变化
- ✅ 无变化时跳过部署，秒级完成
- ✅ 有变化时才重新部署
- ✅ 强制部署: `.\deploy.ps1 -Force`

### 使用场景

| 场景 | 操作 | 说明 |
|------|------|------|
| 首次使用 | `.\deploy.ps1` | 部署文件到服务器 |
| 更新代码 | `.\deploy.ps1` | 检测变化后自动部署 |
| 未修改代码 | `.\deploy.ps1` | 自动跳过，无需等待 |
| 强制重新部署 | `.\deploy.ps1 -Force` | 忽略检查，强制部署 |

---

## 📊 方案对比

| 方案 | 便捷性 | 跨设备 | 跨浏览器 | 推荐度 |
|------|--------|--------|----------|--------|
| 快捷链接 | ⭐⭐⭐⭐⭐ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| PWA 安装 | ⭐⭐⭐⭐⭐ | ❌ | ❌ | ⭐⭐⭐⭐⭐ |
| 配置文件 | ⭐⭐⭐ | ✅ | ✅ | ⭐⭐⭐ |

### 推荐组合

**最佳实践:**
1. **首次配置** → 生成快捷链接 + 导出配置文件 (双保险)
2. **常用设备** → 添加到主屏幕 (最佳体验)
3. **其他设备** → 使用快捷链接 (快速访问)
4. **备份恢复** → 使用配置文件 (数据安全)

---

## ❓ 常见问题

### Q1: 更换手机后配置丢失怎么办？

**A:** 三种方法任选其一：
1. 使用之前保存的快捷链接
2. 导入之前导出的配置文件
3. 重新配置一次，然后生成新的快捷链接

### Q2: 在公司和家里都要用，怎么办？

**A:** 
- 家里: 添加到手机主屏幕 (PWA)
- 公司: 保存快捷链接到浏览器书签
- 两边配置独立，互不影响

### Q3: 朋友也想用，怎么分享？

**A:** 
1. 让朋友自己部署到自己的 Jellyfin 服务器
2. 如果共用服务器，可以直接分享快捷链接
   - **注意**: 链接包含 API Key，确保只分享给信任的人

### Q4: 还是需要重新部署？

**A:** 
- **无需重新部署**: 配置丢失、更换设备等情况
- **需要重新部署**: 只有在更新 HTML/JSON 文件本身时才需要

### Q5: 如何更新到新版本？

**A:**
```powershell
# 拉取最新代码
git pull

# 重新部署
.\deploy.ps1
```

配置会保留，无需重新设置！

---

## 🎉 总结

**核心要点:**
- ✅ HTML 文件只需部署一次
- ✅ 配置可通过多种方式持久化
- ✅ 智能部署避免不必要的操作
- ✅ 一次设置，随时随地使用

**下次使用:**
- 📱 从主屏幕打开 (PWA)
- 🔗 从书签打开 (快捷链接)
- 💻 直接访问 (已保存配置)

**无需重新:**
- ❌ 重新部署
- ❌ 重新配置
- ❌ 记住服务器地址

🎊 **享受流畅的标签筛选体验吧！**
